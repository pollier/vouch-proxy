# Configuration
The vouch proxy configuration is a YAML file describing configuration parameters.

## Main Configuration

| Config        | Section | Default                                     | Options                                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|:--------------|:--------|:--------------------------------------------|:-----------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| logLevel      | vouch   | info                                        | debug, info, warn, error, dpanic, panic, fatal | Vouch uses [zap](https://godoc.org/go.uber.org/zap) for logging.  The levels are described [here](https://github.com/uber-go/zap/blob/master/zapcore/level.go#L32)                                                                                                                                                                                                                                                                                                                                                                         |
| listen        | vouch   | 0.0.0.0                                     |                                                | Valid IP Address.  IPv4 and IPv6 supported                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| port          | vouch   | 9090                                        |                                                | Valid listening port.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| domains       | vouch   |                                             |                                                | Each of these domains must serve the url https://vouch.$domains\[0\] https://vouch.$domains\[1\] ... so that the cookie which stores the JWT can be set in the relevant domain.  You usually *don't* want to list every individual website that will be protected.  if you have siteA.internal.yourdomain.com and siteB.internal.yourdomain.com then your domains should be set as yourdomain.com or perhaps internal.yourdomain.com.   Usually you'll just have one.  This option can only be left unset if allowAllUsers is set to true. |
| allowAllUsers | vouch   | false                                       | true, false                                    | True allows anyone that can authenticate at the configured provider access to the proxies application.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| publicAccess  | vouch   | false                                       | true, false                                    | True will accept all requests, even without a cookie.  If the user is logged in, the cookie will be validated and the user header will be set.  You will need to direct people to the Vouch Proxy login page from your application.                                                                                                                                                                                                                                                                                                        |
| whiteList     | vouch   |                                             |                                                | Allows only a white list of usernames.  Usernames are usually email addresses (google, most oidc providers) or login/username for github and github enterprise                                                                                                                                                                                                                                                                                                                                                                             |
| testing       | vouch   | false                                       | true, false                                    | True enabled a test mode that doesn't send the 200OK to nginx, but instead shows debug messages in the browser.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| test_url      | vouch   |                                             |                                                | Adds a single test url to the index page, making it easier to click on the link and troubleshoot authentication issues.                                                                                                                                                                                                                                                                                                                                                                                                                    |
| test_urls     | vouch   |                                             |                                                | Adds a list of test urls to the index page, making it easier to click on the link and troubleshoot authentication issues.                                                                                                                                                                                                                                                                                                                                                                                                                  |
| webapp        | vouch   | false                                       | true, false                                    | Enabled websockets.  Currentl not fully implemented.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| secret        | jwt     |                                             |                                                | A random string used to cryptographically sign the jwt.  Vouch Proxy complains if the string is less than 44 characters (256 bits as 32 base64 bytes).  If the secret is not configured in config.yml, look for it in `./config/secret`.  if `./config/secret` doesn't exist then randomly generate a secret and store it there.  If you run multiple instances of Vouch you'll want to ensure all instances use the same secret.                                                                                                          |
| issuer        | jwt     | Vouch                                       |                                                | The issue name of the JWT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| maxAge        | jwt     | 240                                         |                                                | The maximum age of the JWT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| compress      | jwt     | true                                        | true, false                                    | True compresses the JWT and encodes the compressed into base64 for storage.  False doesn't compress and simply encodes it into base64 for storage.                                                                                                                                                                                                                                                                                                                                                                                         |
| name          | cookie  | VouchCookie                                 |                                                | The name of the Vouch cookie.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| domain        | cookie  |                                             |                                                | By default Vouch will use the host header domain as the cookie domain.  You can override this by setting this option.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| secure        | cookie  | false                                       | true, false                                    | A secure cookie is only accessible via HTTPS.  By default Vouch runs on HTTP, so this should be disabled unless you run Vouch behind a HTTPS proxy.  See [this](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#Secure_and_HttpOnly_cookies) for more info on secure cookies.                                                                                                                                                                                                                                                    |
| httpOnly      | cookie  | true                                        | true, false                                    | HTTPOnly cookies are only sent to the server, and aren't accessible via Javascript.  See [this](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#Secure_and_HttpOnly_cookies) for more info on HTTPOnly cookies.                                                                                                                                                                                                                                                                                                                  |
| name          | session | VouchSession                                |                                                | The name of session variable stored locally.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| key           | session | 256 bit random encoded into 32 base64 bytes |                                                | The key used to encrypt the sessio information.  If the key is not set here then it is generated at startup and stored in memory. Vouch Proxy complains if the string is less than 44 characters (256 bits as 32 base64 bytes) you only want to set this if you're running multiple user facing vouch.yourdomain.com instances.  If Vouch is restarted, the session key will change unless this is set, forcing all sessions to get recreated when a user browses after a restart.                                                         |
| jwt           | headers | X-Vouch-Token                               |                                                | The name of the header for the JWT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| querystring   | headers | access_token                                |                                                | The name of GET parameter to search for an access token.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| redirect      | headers | X-Vouch-Requested-URI                       |                                                | The name of the header for the original requested uri to redirect to after authentication.                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| user          | headers | X-Vouch-User                                |                                                | The name of the header for the authenticated user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| success       | headers | X-Vouch-Success                             |                                                | The name do the header to store success status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| file          | db      | data/vouch_bolt.db                          |                                                | The location of the Vouch database.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

## OAuth Provider Configuration

### Google

Vouch can authenticate a user using Google OAuth.
Create credentials here: [https://console.developers.google.com/apis/credentials](https://console.developers.google.com/apis/credentials)

| Config        | Section       | Default       | Options       | Description   |
| :------------ | :------------ | :------------ | :------------ | :------------ |
| provider      | oauth         |               | google        | Set the provider as Google. |
| client_id     | oauth         |               |               | Your client id from Google. |
| client_secret | oauth         |               |               | Your client secret from Google. |
| callback_urls | oauth         |               |               | The list of urls for Google to callback to Vouch after authentication.  This should include one callback url per domain. |
| preferredDomain | oauth       |               |               | The preferred domain for Google authentication. |

### GitHub

Vouch can authenticate a user using Github.  Please see instructions for setting up GitHub to support this [here](https://developer.github.com/apps/building-integrations/setting-up-and-registering-oauth-apps/about-authorization-options-for-oauth-apps/)

| Config        | Section       | Default       | Options       | Description   |
| :------------ | :------------ | :------------ | :------------ | :------------ |
| provider      | oauth         |               | github        | Set the provider as GitHub. |
| client_id     | oauth         |               |               | Your client id from GitHub. |
| client_secret | oauth         |               |               | Your client secret from GitHub. |
| auth_url      | oauth         |               |               | Your authentication url from GitHub Enterprise or on-prem.  Only required for Enterprise/On-Prem. |
| token_url     | oauth         |               |               | Your token url from GitHub Enterprise or on-prem.  Only required for Enterprise/On-Prem. |
| user_info_url | oauth         |               |               | Your user info url from GitHub Enterprise or on-prem.  Only required for Enterprise/On-Prem. |

### Generic OpenID Connect

Vouch can authenticate to pretty much any provider that provides OpenID Connect compatible authentication.  This includes products such as Active Directory Federated Services (ADFS), KeyCloak, and others.

| Config        | Section       | Default       | Options       | Description   |
| :------------ | :------------ | :------------ | :------------ | :------------ |
| provider      | oauth         |               | oidc          | Set the provider as oidc. |
| client_id     | oauth         |               |               | Your client id from the OIDC provider. |
| client_secret | oauth         |               |               | Your client secret from the OIDC provider. |
| auth_url      | oauth         |               |               | Your authentication url from the OIDC provider. |
| token_url     | oauth         |               |               | Your token url from the OIDC provider. |
| user_info_url | oauth         |               |               | Your user info url from the OIDC provider. |
| scopes        | oauth         |               |               | Your list of scopes from the OIDC provider.  These are generally openid, email, profile. |
| callback_url  | oauth         |               |               | The url the OIDC provider will callback to after authentication. |


### IndieAuth

Vouch can authenticate a user using IndieAuth.  See API documentation [here](https://indielogin.com/api)

| Config        | Section       | Default       | Options       | Description   |
| :------------ | :------------ | :------------ | :------------ | :------------ |
| provider      | oauth         |               | indieauth     | Set the provider as IndieAuth. |
| client_id     | oauth         |               |               | Your client id from IndieAuth. |
| auth_url      | oauth         |               |               | Your authentication url from IndieAuth. |
| callback_url  | oauth         |               |               | The url IndieAuth will callback to after authentication. |